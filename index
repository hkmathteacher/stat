<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•¸æ“šå°çµ±è¨ˆé‡çš„å½±éŸ¿å±•ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            background-color: #f3f4f6;
            /* Prevent bounce effect on iOS */
            overscroll-behavior-y: none; 
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        /* Optimized Switch for Touch */
        .toggle-checkbox {
            right: 0;
            z-index: 10;
            opacity: 0;
            cursor: pointer;
        }
        .toggle-label {
            width: 3.5rem; /* Larger width */
            height: 2rem;  /* Larger height */
            background-color: #d1d5db;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .toggle-label:before {
            content: "";
            position: absolute;
            top: 0.25rem;
            left: 0.25rem;
            width: 1.5rem;
            height: 1.5rem;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563eb;
        }
        .toggle-checkbox:checked + .toggle-label:before {
            transform: translateX(1.5rem);
        }
        
        /* Better touch response for buttons */
        button {
            touch-action: manipulation;
        }
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen">

    <div class="container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- Header -->
        <header class="mb-6 text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-800 mb-2">çµ±è¨ˆé‡äº’å‹•å¯¦é©—å®¤</h1>
            <p class="text-gray-600 text-sm md:text-base">ä¿®æ”¹æ•¸æ“šï¼Œè§€å¯Ÿå°å¹³å‡æ•¸ã€ä¸­ä½æ•¸ã€æ¨™æº–å·®ç­‰çµ±è¨ˆé‡çš„å½±éŸ¿ã€‚</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Column: Controls -->
            <!-- Layout Note: On Tablet (md), split this column into grid-cols-2 to save vertical space -->
            <div class="lg:col-span-4 xl:col-span-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-1 gap-6 content-start">
                
                <!-- Data Input -->
                <div class="bg-white p-5 rounded-xl shadow-md md:col-span-2 lg:col-span-1">
                    <label class="block text-base font-bold text-gray-700 mb-2">è¼¸å…¥æ•¸æ“š (ä»¥é€—è™Ÿåˆ†éš”):</label>
                    <textarea id="dataInput" rows="3" class="w-full p-4 border border-gray-300 rounded-xl font-mono text-lg md:text-xl shadow-sm transition-colors" placeholder="ä¾‹å¦‚: 10, 20, 30...">10, 12, 15, 15, 18, 20, 22</textarea>
                    <div class="mt-3 text-sm text-gray-500 flex justify-between items-center">
                        <span id="countDisplay" class="bg-gray-100 px-2 py-1 rounded">n = 7</span>
                        <button onclick="resetData()" class="text-blue-600 font-medium px-3 py-1 hover:bg-blue-50 rounded-lg transition">
                            â†º é‡ç½®é è¨­å€¼
                        </button>
                    </div>
                </div>

                <!-- Scenario Buttons -->
                <div class="bg-white p-5 rounded-xl shadow-md flex flex-col justify-center">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">å¯¦é©—å ´æ™¯</h3>
                    <div class="space-y-3">
                        <button onclick="shiftData(5)" class="w-full text-left px-4 py-4 bg-blue-50 hover:bg-blue-100 active:bg-blue-200 text-blue-800 rounded-xl transition flex items-center group border border-blue-100 shadow-sm">
                            <span class="bg-blue-200 p-2 rounded-lg mr-3 text-sm font-bold group-hover:bg-blue-300 shadow-sm">+5</span>
                            <div>
                                <div class="font-bold text-lg">æ•¸æ“šå¹³ç§»</div>
                                <div class="text-xs text-blue-600 opacity-80 mt-0.5">é›†ä¸­è¶¨å‹¢å¢åŠ ï¼Œé›¢å·®ä¸è®Š</div>
                            </div>
                        </button>

                        <button onclick="multiplyData(2)" class="w-full text-left px-4 py-4 bg-purple-50 hover:bg-purple-100 active:bg-purple-200 text-purple-800 rounded-xl transition flex items-center group border border-purple-100 shadow-sm">
                            <span class="bg-purple-200 p-2 rounded-lg mr-3 text-sm font-bold group-hover:bg-purple-300 shadow-sm">x2</span>
                            <div>
                                <div class="font-bold text-lg">æ•¸æ“šå€å¢</div>
                                <div class="text-xs text-purple-600 opacity-80 mt-0.5">åˆ†ä½ˆè®Šå¯¬ (SDè®Šå¤§)</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Legend -->
                <div class="bg-white p-5 rounded-xl shadow-md flex flex-col justify-center">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">åœ–ä¾‹èªªæ˜</h3>
                    <div class="space-y-3 text-sm md:text-base">
                        <div class="flex items-center p-1">
                            <div class="w-4 h-4 rounded-full bg-blue-500 mr-3 shadow-sm"></div>
                            <span class="text-gray-700">æ•¸æ“šé» (Dot)</span>
                        </div>
                        <div class="flex items-center p-1">
                            <div class="w-5 h-1.5 bg-emerald-500 mr-3 rounded-full"></div>
                            <span class="text-gray-700">ä¸­ä½æ•¸ (Median)</span>
                        </div>
                        <div class="flex items-center p-1">
                            <div class="w-5 h-1.5 bg-gray-400 mr-3 rounded-full"></div>
                            <span class="text-gray-700">å››åˆ†ä½æ•¸é–“è· (IQR)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Visualization and Stats -->
            <div class="lg:col-span-8 xl:col-span-9 space-y-6">
                
                <!-- Dot Plot Canvas Area -->
                <div class="bg-white p-5 rounded-xl shadow-md border-l-4 border-blue-500">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                æ•¸ç·šåˆ†æ
                                <span class="ml-2 text-xs font-normal text-white bg-blue-500 px-2 py-0.5 rounded-full">æ¨è–¦</span>
                            </h3>
                            <p class="text-sm text-gray-500 mt-1">
                                é–å®šæ•¸ç·šå¾Œé€²è¡Œå¹³ç§»ï¼Œå¯è§€å¯Ÿæ•¸æ“šæ•´é«”ç§»å‹•ã€‚
                            </p>
                        </div>
                        
                        <!-- Toggle Switch (Larger for Touch) -->
                        <div class="flex items-center bg-gray-50 p-3 rounded-xl border border-gray-200 shadow-inner">
                            <span class="text-sm md:text-base text-gray-700 mr-3 font-bold" id="lockLabel">è‡ªå‹•ç¸®æ”¾</span>
                            <div class="relative flex items-center">
                                <input type="checkbox" id="axisLockToggle" onchange="toggleAxisLock()" class="toggle-checkbox absolute w-full h-full appearance-none"/>
                                <label for="axisLockToggle" class="toggle-label block"></label>
                            </div>
                            <button onclick="resetAxis()" id="resetAxisBtn" class="hidden text-sm bg-white hover:bg-gray-100 active:bg-gray-200 text-blue-600 font-bold px-3 py-1.5 rounded-lg border border-blue-200 shadow-sm ml-3 transition">
                                é‡ç½®
                            </button>
                        </div>
                    </div>

                    <div class="relative w-full h-56 md:h-64 bg-gray-50 rounded-lg border border-gray-100">
                        <canvas id="dotPlotCanvas" class="w-full h-full"></canvas>
                    </div>
                </div>

                <!-- Stats Grid (Responsive adjustment) -->
                <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-3 md:gap-4">
                    <!-- Mean -->
                    <div class="stat-card bg-blue-600 text-white p-4 rounded-xl shadow-md relative overflow-hidden">
                        <div class="absolute -bottom-2 -right-2 text-6xl opacity-10 font-serif">Î¼</div>
                        <h4 class="text-blue-100 text-xs font-bold uppercase tracking-wider">å¹³å‡æ•¸</h4>
                        <div id="valMean" class="text-2xl md:text-3xl font-bold mt-1 tracking-tight">-</div>
                    </div>

                    <!-- Median -->
                    <div class="stat-card bg-emerald-500 text-white p-4 rounded-xl shadow-md relative overflow-hidden">
                         <div class="absolute -bottom-2 -right-2 text-6xl opacity-10 font-serif">M</div>
                        <h4 class="text-emerald-100 text-xs font-bold uppercase tracking-wider">ä¸­ä½æ•¸</h4>
                        <div id="valMedian" class="text-2xl md:text-3xl font-bold mt-1 tracking-tight">-</div>
                    </div>

                    <!-- Mode -->
                    <div class="stat-card bg-purple-500 text-white p-4 rounded-xl shadow-md relative overflow-hidden">
                        <div class="absolute -bottom-2 -right-2 text-6xl opacity-10 font-serif">Mo</div>
                        <h4 class="text-purple-100 text-xs font-bold uppercase tracking-wider">çœ¾æ•¸</h4>
                        <div id="valMode" class="text-xl md:text-2xl font-bold mt-2 truncate">-</div>
                    </div>

                    <!-- Range -->
                    <div class="stat-card bg-white p-4 rounded-xl shadow border border-gray-200">
                        <h4 class="text-gray-400 text-xs font-bold uppercase tracking-wider">åˆ†ä½ˆåŸŸ</h4>
                        <div id="valRange" class="text-2xl md:text-3xl font-bold text-gray-700 mt-1">-</div>
                    </div>

                    <!-- IQR -->
                    <div class="stat-card bg-white p-4 rounded-xl shadow border border-gray-200">
                        <h4 class="text-gray-400 text-xs font-bold uppercase tracking-wider">IQR</h4>
                        <div id="valIQR" class="text-2xl md:text-3xl font-bold text-gray-700 mt-1">-</div>
                    </div>

                    <!-- SD/Var Group -->
                    <div class="stat-card bg-orange-50 p-4 rounded-xl shadow border border-orange-100 flex flex-col justify-center">
                        <div class="flex justify-between items-baseline mb-1">
                            <span class="text-xs text-orange-800 font-bold uppercase">SD(Ïƒ)</span>
                            <span id="valSD" class="text-xl font-bold text-orange-700">-</span>
                        </div>
                        <div class="w-full h-px bg-orange-200 my-1"></div>
                        <div class="flex justify-between items-baseline">
                            <span class="text-xs text-orange-800 font-bold uppercase">Var(ÏƒÂ²)</span>
                            <span id="valVar" class="text-xl font-bold text-orange-700">-</span>
                        </div>
                    </div>
                </div>

                <!-- Histogram Area -->
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">é »æ•¸åˆ†ä½ˆåœ– (Histogram)</h3>
                    <div class="relative h-48 md:h-56 w-full">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>

                <!-- Explanation Section -->
                <div class="bg-blue-50 border border-blue-100 rounded-xl p-5 md:p-6">
                    <h3 class="text-lg font-bold text-blue-900 mb-3 flex items-center">
                        ğŸ’¡ è§€å¯Ÿé‡é»
                    </h3>
                    <ul class="list-disc list-inside text-blue-800 space-y-2 text-sm md:text-base leading-relaxed">
                        <li><strong>åˆ©ç”¨é–å®šåŠŸèƒ½</strong>ï¼šé–‹å•Ÿã€Œé–å®šåº§æ¨™è»¸ã€ï¼Œç„¶å¾Œé»æ“Šã€Œæ•¸æ“šå¹³ç§» (+5)ã€ã€‚ä½ æœƒç™¼ç¾æ‰€æœ‰é»ä¸€èµ·å‘å³ç§»å‹•ï¼Œå°±åƒä¸€è¼›ç«è»Šï¼Œè»Šå»‚ä¹‹é–“çš„è·é›¢ï¼ˆé›¢æ•£ç¨‹åº¦ï¼‰å®Œå…¨æ²’æœ‰æ”¹è®Šã€‚</li>
                        <li><strong>å››åˆ†ä½æ•¸é–“è· (IQR)</strong>ï¼šç°è‰²ç·šæ®µä»£è¡¨ä¸­é–“ 50% æ•¸æ“šçš„ç¯„åœ (Q1 åˆ° Q3)ã€‚é€™æ®µé•·åº¦ç›´è§€åœ°é¡¯ç¤ºäº†æ•¸æ“šä¸­é–“éƒ¨åˆ†çš„é›†ä¸­ç¨‹åº¦ã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let chartInstance = null;
        const defaultData = "10, 12, 15, 15, 18, 20, 22";
        
        // Axis Locking State
        let isAxisLocked = false;
        let lockedMin = 0;
        let lockedMax = 100;

        // --- DOM Elements ---
        const inputEl = document.getElementById('dataInput');
        const countEl = document.getElementById('countDisplay');

        // Stats Elements
        const els = {
            mean: document.getElementById('valMean'),
            median: document.getElementById('valMedian'),
            mode: document.getElementById('valMode'),
            range: document.getElementById('valRange'),
            iqr: document.getElementById('valIQR'),
            sd: document.getElementById('valSD'),
            variance: document.getElementById('valVar')
        };

        // --- Event Listeners ---
        inputEl.addEventListener('input', calculateAndRender);
        window.addEventListener('resize', calculateAndRender); // Re-render canvas on resize
        
        // --- Initialization ---
        window.onload = () => {
            calculateAndRender();
        };

        // --- Core Logic ---

        function getNumbers() {
            const raw = inputEl.value;
            const nums = raw.split(/[\s,]+/)
                           .filter(s => s.trim() !== '' && !isNaN(Number(s)))
                           .map(Number);
            return nums.sort((a, b) => a - b);
        }

        function calculateAndRender() {
            const nums = getNumbers();
            
            countEl.textContent = `æ•¸é‡ n = ${nums.length}`;

            if (nums.length === 0) {
                Object.values(els).forEach(el => el.textContent = "-");
                updateChart([]);
                drawDotPlot([], {});
                return;
            }

            const stats = calculateStats(nums);

            // Render Stats Text
            els.mean.textContent = round(stats.mean);
            els.median.textContent = round(stats.median);
            els.mode.textContent = stats.mode.join(', ') || 'ç„¡';
            els.range.textContent = round(stats.range);
            els.iqr.textContent = round(stats.iqr);
            els.sd.textContent = round(stats.sd);
            els.variance.textContent = round(stats.variance);

            // Visualizations
            updateChart(nums);
            drawDotPlot(nums, stats);
        }

        function calculateStats(arr) {
            const n = arr.length;
            const sum = arr.reduce((a, b) => a + b, 0);
            const mean = sum / n;

            // Median
            let median;
            const mid = Math.floor(n / 2);
            if (n % 2 !== 0) {
                median = arr[mid];
            } else {
                median = (arr[mid - 1] + arr[mid]) / 2;
            }

            // Mode
            const counts = {};
            let maxFreq = 0;
            arr.forEach(num => {
                counts[num] = (counts[num] || 0) + 1;
                if (counts[num] > maxFreq) maxFreq = counts[num];
            });
            let modes = [];
            if (maxFreq > 1) { 
                if (maxFreq === 1 && n > 1) {
                    modes = ["ç„¡"];
                } else {
                    for (const num in counts) {
                        if (counts[num] === maxFreq) modes.push(num);
                    }
                }
            } else {
                 modes = n === 1 ? [arr[0]] : ["ç„¡"];
            }

            // Range
            const range = arr[n - 1] - arr[0];

            // SD & Variance
            const variance = arr.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / n;
            const sd = Math.sqrt(variance);

            // IQR
            let lowerHalf = [];
            let upperHalf = [];
            if (n % 2 === 0) {
                lowerHalf = arr.slice(0, mid);
                upperHalf = arr.slice(mid);
            } else {
                lowerHalf = arr.slice(0, mid);
                upperHalf = arr.slice(mid + 1);
            }
            const q1 = getMedian(lowerHalf);
            const q3 = getMedian(upperHalf);
            const iqr = q3 - q1;

            return { mean, median, mode: modes, range, variance, sd, iqr, q1, q3, min: arr[0], max: arr[n-1] };
        }

        function getMedian(arr) {
            if (arr.length === 0) return 0;
            const mid = Math.floor(arr.length / 2);
            if (arr.length % 2 !== 0) return arr[mid];
            return (arr[mid - 1] + arr[mid]) / 2;
        }

        function round(num) {
            return Math.round(num * 100) / 100;
        }

        // --- Chart.js Histogram ---
        function updateChart(nums) {
            const ctx = document.getElementById('myChart').getContext('2d');
            const freqMap = {};
            nums.forEach(n => freqMap[n] = (freqMap[n] || 0) + 1);
            const labels = Object.keys(freqMap).map(Number).sort((a,b) => a-b);
            const data = labels.map(l => freqMap[l]);

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'é »æ•¸',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 }, display: false },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- Axis Lock Logic ---
        function toggleAxisLock() {
            const checkbox = document.getElementById('axisLockToggle');
            const label = document.getElementById('lockLabel');
            const resetBtn = document.getElementById('resetAxisBtn');

            isAxisLocked = checkbox.checked;

            if (isAxisLocked) {
                // Lock Logic (Fixed 0-100)
                label.textContent = "å·²é–å®š (0-100)";
                label.classList.add('text-blue-700');
                resetBtn.classList.remove('hidden');

                lockedMin = 0;
                lockedMax = 100;
            } else {
                // Unlock
                label.textContent = "è‡ªå‹•ç¸®æ”¾";
                label.classList.remove('text-blue-700');
                resetBtn.classList.add('hidden');
            }
            calculateAndRender();
        }

        function resetAxis() {
            document.getElementById('axisLockToggle').checked = false;
            toggleAxisLock();
        }

        // --- Custom Dot Plot & Number Line Logic ---
        function drawDotPlot(nums, stats) {
            const canvas = document.getElementById('dotPlotCanvas');
            const ctx = canvas.getContext('2d');
            
            // Handle high DPI displays
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            ctx.clearRect(0, 0, rect.width, rect.height);

            if (nums.length === 0) return;

            // Dimensions
            const w = rect.width;
            const h = rect.height;
            const padding = 40;
            const bottomMargin = 40;
            
            // Calculate Scale Range
            let minVal, maxVal;

            if (isAxisLocked) {
                minVal = lockedMin;
                maxVal = lockedMax;
            } else {
                // Auto Scale Logic
                minVal = stats.min;
                maxVal = stats.max;
                let range = maxVal - minVal;
                
                if (range === 0) {
                    minVal -= 5;
                    maxVal += 5;
                } else {
                    const buffer = range * 0.15;
                    minVal -= buffer;
                    maxVal += buffer;
                }
            }
            
            let range = maxVal - minVal;
            if (range <= 0) range = 10; // Safety

            const getX = (val) => {
                return padding + ((val - minVal) / range) * (w - 2 * padding);
            };

            // --- Draw Background Grid / Ticks ---
            const rawStep = range / 10;
            const magnitude = Math.pow(10, Math.floor(Math.log10(rawStep)));
            let stepSize;
            if (rawStep / magnitude < 2) stepSize = magnitude;
            else if (rawStep / magnitude < 5) stepSize = 2 * magnitude;
            else stepSize = 5 * magnitude;
            
            ctx.strokeStyle = "#e5e7eb"; 
            ctx.lineWidth = 1;
            ctx.font = "12px sans-serif"; // Larger font for tablet
            ctx.fillStyle = "#9ca3af";
            ctx.textAlign = "center";

            const startTick = Math.ceil(minVal / stepSize) * stepSize;
            for (let v = startTick; v <= maxVal; v += stepSize) {
                const x = getX(v);
                if (x < padding || x > w - padding) continue;
                
                ctx.beginPath();
                ctx.moveTo(x, 20);
                ctx.lineTo(x, h - bottomMargin);
                ctx.stroke();

                ctx.fillText(Math.round(v * 100) / 100, x, h - bottomMargin + 20);
            }

            // 2. Draw IQR Line
            const q1X = getX(stats.q1);
            const q3X = getX(stats.q3);
            const iqrY = h - bottomMargin + 30; // More space for touch readability
            
            if (q3X > padding && q1X < w - padding) {
                ctx.beginPath();
                ctx.strokeStyle = "#9ca3af"; 
                ctx.lineWidth = 4; // Thicker line
                ctx.moveTo(Math.max(padding, q1X), iqrY);
                ctx.lineTo(Math.min(w-padding, q3X), iqrY);
                ctx.stroke();
                
                // Caps
                if (q1X >= padding && q1X <= w-padding) {
                     ctx.beginPath(); ctx.moveTo(q1X, iqrY-6); ctx.lineTo(q1X, iqrY+6); ctx.stroke();
                }
                if (q3X >= padding && q3X <= w-padding) {
                     ctx.beginPath(); ctx.moveTo(q3X, iqrY-6); ctx.lineTo(q3X, iqrY+6); ctx.stroke();
                }
            }

            // 3. Draw Axis Line
            const axisY = h - bottomMargin;
            ctx.beginPath();
            ctx.strokeStyle = "#374151"; 
            ctx.lineWidth = 2;
            ctx.moveTo(padding, axisY);
            ctx.lineTo(w - padding, axisY);
            ctx.stroke();

            // 5. Draw Median Line
            const medianX = getX(stats.median);
            if (medianX >= padding && medianX <= w - padding) {
                ctx.beginPath();
                ctx.strokeStyle = "#10b981"; 
                ctx.lineWidth = 3; // Thicker line
                ctx.moveTo(medianX, 20);
                ctx.lineTo(medianX, axisY + 5);
                ctx.stroke();
                
                ctx.fillStyle = "#10b981";
                ctx.font = "bold 14px sans-serif"; // Larger font
                ctx.fillText("M", medianX, 15);
            }

            // 6. Draw Dots
            const dotRadius = 6; // Larger dots
            const counts = {}; 
            
            ctx.fillStyle = "rgba(59, 130, 246, 0.9)";
            
            nums.forEach(num => {
                const x = getX(num);
                if (x < padding - dotRadius || x > w - padding + dotRadius) return;

                const stackIndex = counts[num] || 0;
                counts[num] = stackIndex + 1;
                
                const y = axisY - 12 - (stackIndex * (dotRadius * 2 + 4)); 
                
                ctx.beginPath();
                ctx.arc(x, y, dotRadius, 0, Math.PI * 2);
                ctx.fill();
            });
            
            if (stats.min < minVal || stats.max > maxVal) {
                ctx.fillStyle = "#ef4444";
                ctx.font = "bold 14px sans-serif";
                ctx.textAlign = "right";
                ctx.fillText("âš ï¸ éƒ¨åˆ†æ•¸æ“šåœ¨è¦–åœ–å¤–", w - padding, 30);
            }
        }

        // --- Scenario Functions ---
        function resetData() {
            inputEl.value = defaultData;
            calculateAndRender();
            flashInput();
        }

        function shiftData(amount) {
            let nums = getNumbers();
            nums = nums.map(n => n + amount);
            inputEl.value = nums.join(', ');
            calculateAndRender();
            flashInput();
        }

        function multiplyData(factor) {
            let nums = getNumbers();
            nums = nums.map(n => n * factor);
            inputEl.value = nums.join(', ');
            calculateAndRender();
            flashInput();
        }

        function flashInput() {
            inputEl.classList.add('bg-blue-50');
            setTimeout(() => inputEl.classList.remove('bg-blue-50'), 300);
        }
    </script>
</body>
</html>
